@using Localizable.Models
@model System.Collections.Generic.List<Models.TranslationKey>
@{
    ViewBag.Title = "Translations";
    Layout = null;
}
<p>
    Please help maintain the high quality translations by voting once per translation
    (provided you feel qualified to do so).
</p>
<table>
@foreach (var key in Model)
{
    <tr>
        <th colspan="5" style="white-space: nowrap">@key.Key</th>
    </tr>
    foreach (var translation in key.Translations.OrderByDescending(t => t.RelativeScore))
    {
        <tr id="translationRow@(translation.Id)">
            <td>@translation.Language
            </td>
            <td>@translation.Value
            </td>
            <td id="translationRelativeScore@(translation.Id)" style="white-space: nowrap">@(translation.RelativeScore)
            </td>
            <td>
                <a href="@Url.Action("Vote", "Oauth", new { translation = translation.Id, direction = "up" })" class="vote button" data-translationId="@translation.Id" data-direction="up">
                    +</a>
            </td>
            <td>
                <a href="@Url.Action("Vote", "Oauth", new { translation = translation.Id, direction = "down" })" class="vote button" data-translationId="@translation.Id" data-direction="down">
                    -</a>
            </td>
        </tr>
    }
    <br />
}
</table>
@if (CurrentUser.IsAuthenticated)
{
    <script>
        $(function () {
            $("a.vote").click(function () {
                var $this = $(this);
                var id = $this.data("translationId");

                $.post('@Url.Action("Vote")', { translation: id, direction: $this.data("direction") }, function (data) {
                    $("#translationRelativeScore" + id).text(data);
                    $("#translationRow" + id).find("a.vote.button").remove();
                });
                return false;
            });
        });
    </script>
}
